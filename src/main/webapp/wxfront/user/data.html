<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>客户数据中心-数据统计</title>
  <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="../css/bootstrap.min.css"/>
  <link rel="stylesheet" href="../css/index.css"/>
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/LArea.css">
  <script src="../../static/js/jquery.min.js" type="text/javascript"></script>
  <script src="../js/CONSTANT.js" type="text/javascript"></script>
  <script src="../js/common.utils.js" type="text/javascript"></script>
  <script src="../js/echarts.common.min.js" type="text/javascript"></script>

<style>
@media (max-width: 767px) {
  .table-responsive {
    width: 100%;
    margin-bottom: 15px;
    overflow-x: scroll;
    overflow-y: hidden;
    /*border: 1px solid #dddddd;*/
    -ms-overflow-style: -ms-autohiding-scrollbar;
    -webkit-overflow-scrolling: touch;
  }
  .table-responsive td {border-bottom: 1px solid #dddddd;line-height:2rem;text-align:center;}
  .table-responsive thead { font-weight:bold;}
  .table-responsive thead td {border-bottom: 2px solid #dddddd;line-height:2.5rem;border-top: 1px solid #dddddd;}
  .table-responsive tbody td {color:#666;}
  .table-responsive > .table {
    margin-bottom: 0;
  }
  .table-responsive > .table > thead > tr > th,
  .table-responsive > .table > tbody > tr > th,
  .table-responsive > .table > tfoot > tr > th,
  .table-responsive > .table > thead > tr > td,
  .table-responsive > .table > tbody > tr > td,
  .table-responsive > .table > tfoot > tr > td {
    white-space: nowrap;
  }
}
ul,li{ list-style: none;font-size:1rem;}
li img {width:1rem;height:1rem;margin-top:.8rem;margin-right:.3rem}
.tabClick{ background: #19a6ee; overflow: hidden;color:#fff; }
.tabClick li{ height:44px; line-height: 44px; width: 33.3%; float: left; text-align: center}
.tabClick li.active{ color: #fff; transition: 0.1s; font-weight: bold}
.tabCon{ overflow: hidden}
.tabBox{ position: relative}
.tabList{word-break: break-all; width:100%;float:left;text-align:center;}
.lineBorder{ height: 2px; overflow: hidden; border-bottom:1px solid #006598; background: #19a6ee}
.lineDiv{ background: #006598; height: 2px; width: 33.3%;}
</style>

</head>

<body>
<div class="wrap" id="wrap">
  <ul class="tabClick">
    <li class="active"><img src="../images/pic_13.png">日数据统计</li>
    <li><img src="../images/pic_14.png">周数据统计</li>
    <li><img src="../images/pic_15.png">月数据统计</li>
  </ul>
  <div class="lineBorder">
    <div class="lineDiv"><!--移动的div--></div>
  </div>
  <input type="hidden" id="beginDate" value="">
  <input type="hidden" id="endDate" value="">
  <input type="hidden" id="weekFirstDay" value="">
  <input type="hidden" id="weekLastDay" value="">
  <input type="hidden" id="monthFirstDay" value="">
  <input type="hidden" id="monthLastDay" value="">
  <div class="tabCon">
    <div class="tabBox">
      <div class="tabList">
        <div class="item_sflr row" style="width:100%; border:1px solid #FFFFFF;margin:0;padding:0;" >
          <div class="inputdate02">
            <button id="preDate" class="btn btn-primary btn-primary-left" onclick="preDay()">前一天</button><input type="date" placeholder="" id="nowDate" oninput="OnInput(event)" value="请输入日期" style="width:60%;"><button id="nextDate" class="btn btn-primary btn-primary-right" onclick="nextDay()">后一天</button>
          </div>
        </div>
        <div style="line-height:2rem;text-align:center;font-size:1.2rem;padding:0 1.2rem;">天成团队<span id="nowDayText"></span>客户来访日数据统计</div>
        <table border="0" cellspacing="0" cellpadding="0" class="table-responsive">
          <thead>
            <tr><td>顾问</td><td>日访</td><td>首访</td><td>复访</td><td>成交</td></tr>
          </thead>
          <tbody id="tbl">

          </tbody>
        </table>
        <div id="dayEcharts" style="width: 100%;height:400px;"></div>
      </div>
      <div class="tabList">
        <div class="item_sflr row" style="width:100%; border:1px solid #FFFFFF;margin:0;padding:0;">
          <div class="inputdate02">
            <button id="preWeek" class="btn btn-primary btn-primary-left" onclick="preWeek()">前一周</button><input type="date" placeholder="" id="nowWeek" oninput="OnInput(event)" value="请输入日期" style="width:60%;"><button id="nextWeek" class="btn btn-primary btn-primary-right" onclick="nextWeek()">后一周</button>
          </div>
        </div>
        <div style="line-height:2rem;text-align:center;font-size:1.2rem;padding:0 1.2rem;">天成团队<span id="nowWeekText"></span>客户来访周数据统计</div>
        <table border="0" cellspacing="0" cellpadding="0" class="table-responsive">
          <thead>
            <tr><td>顾问</td><td>周访</td><td>首访</td><td>复访</td><td>成交</td></tr>
          </thead>
          <tbody id="tb2">

          </tbody>
        </table>
        <div id="weekEcharts" style="width: 100%;height:400px;"></div>
      </div>
      <div class="tabList">
        <div class="item_sflr row" style="width:100%; border:1px solid #FFFFFF;margin:0;padding:0;">
          <div class="inputdate02">
            <button id="preMonth" class="btn btn-primary btn-primary-left" onclick="preMonth()">前一月</button><input type="month" placeholder="Birth day" oninput="OnInput(event)" id="nowMonth" value="" style="width:60%;"><button id="nextMonth" class="btn btn-primary btn-primary-right" onclick="nextMonth()">后一月</button>
          </div>
        </div>
        <div style="line-height:2rem;text-align:center;font-size:1.2rem;padding:0 1.2rem;">天成团队<span id="nowMonthText"></span>客户来访月数据统计</div>
        <table border="0" cellspacing="0" cellpadding="0" class="table-responsive">
          <thead>
            <tr><td>顾问</td><td>月访</td><td>首访</td><td>复访</td><td>成交</td></tr>
          </thead>
          <tbody id="tb3">
       
          </tbody>
        </table>
        <div id="monthEcharts" style="width: 100%;height:400px;"></div>
      </div>
    </div>
  </div>
</div>

<script src="datePicker.js"></script>
<!-- <script src="myEchart.js"></script> -->
<script charset="utf-8">
function xlh(){
  var tbl=document.getElementById("tbl");
  var rows=tbl.rows.length;
  for (var i=0;i<rows;i++) {
    if(i%2 == 0) tbl.rows[i].style.backgroundColor= "#f9f9f9";
    else tbl.rows[i].style.backgroundColor="#fff";
  }
}

$(function(){
  xlh();
  var windowWidth=document.body.clientWidth; //window 宽度;
  var wrap=document.getElementById('wrap');
  var tabClick=wrap.querySelectorAll('.tabClick')[0];
  var tabLi=tabClick.getElementsByTagName('li');
  var tabBox= wrap.querySelectorAll('.tabBox')[0];
  var tabList=tabBox.querySelectorAll('.tabList');
  var lineBorder=wrap.querySelectorAll('.lineBorder')[0];
  var lineDiv=lineBorder.querySelectorAll('.lineDiv')[0];

  var tar=0;
  var endX=0;
  var dist=0;

  tabBox.style.overflow='hidden';
  tabBox.style.position='relative';
  tabBox.style.width=windowWidth*tabList.length+"px";

  tabBox.addEventListener('touchstart',chstart,false);
  tabBox.addEventListener('touchmove',chmove,false);
  tabBox.addEventListener('touchend',chend,false);

  for(var i=0 ;i<tabLi.length; i++ ){
    tabList[i].style.width=windowWidth+"px";
    tabList[i].style.float='left';
    tabList[i].style.float='left';
    tabList[i].style.padding='0';
    tabList[i].style.margin='0';
    tabList[i].style.verticalAlign='top';
    tabList[i].style.display='table-cell';
  }

  for(var i=0 ;i<tabLi.length; i++ ){
    tabLi[i].start=i;
    tabLi[i].onclick=function(){
      var star=this.start;
      for(var i=0 ;i<tabLi.length; i++ ){
        tabLi[i].className='';
      }
      tabLi[star].className='active';
      init.lineAnme(lineDiv,windowWidth/tabLi.length*star)
      init.translate(tabBox,windowWidth,star);
      endX= -star*windowWidth;
    }
  }
  function OnTab(star) {
    if(star<0) star=0;
    else
    if(star>=tabLi.length) star=tabLi.length-1;
    for(var i=0 ;i<tabLi.length; i++ ){
      tabLi[i].className='';
    }
    tabLi[star].className='active';
    init.translate(tabBox,windowWidth,star);
    endX= -star*windowWidth;
  }
  //按下
  function chstart(ev){
    ev.preventDefault;
    var touch=ev.touches[0];
    tar=touch.pageX;
    tabBox.style.webkitTransition='all 0s ease-in-out';
    tabBox.style.transition='all 0s ease-in-out';
  };
  //滑动
  function chmove(ev){
    var stars=wrap.querySelector('.active').start;
    ev.preventDefault;
    var touch=ev.touches[0];
    var distance=touch.pageX-tar;
    dist=distance;
    init.touchs(tabBox,windowWidth,tar,distance,endX);
    init.lineAnme(lineDiv,-dist/tabLi.length-endX/4);
  };
  //离开
  function chend(ev){
    var str= tabBox.style.transform;
    var strs=JSON.stringify(str.split(",",1));  
    endX=Number(strs.substr(14,strs.length-18)); 
    if (endX>0) {
       init.back(tabBox,windowWidth,tar,0,0,0.3);
       endX=0
    } else
    if (endX<-windowWidth*tabList.length+windowWidth) {
      endX=-windowWidth*tabList.length+windowWidth
      init.back(tabBox,windowWidth,tar,0,endX,0.3);
    } else
    if (dist<-windowWidth/3) {
      OnTab(tabClick.querySelector('.active').start+1);
      init.back(tabBox,windowWidth,tar,0,endX,0.3);
    } else
    if (dist>windowWidth/3) {
      OnTab(tabClick.querySelector('.active').start-1);
    } else {
      OnTab(tabClick.querySelector('.active').start);
    }
    var stars=wrap.querySelector('.active').start;
    init.lineAnme(lineDiv,stars*windowWidth/4);
  };
});
  
var init={
  translate:function(obj,windowWidth,star){
    obj.style.webkitTransform='translate3d('+-star*windowWidth+'px,0,0)';
    obj.style.transform='translate3d('+-star*windowWidth+',0,0)px';
    obj.style.webkitTransition='all 0.3s ease-in-out';
    obj.style.transition='all 0.3s ease-in-out';
  },
  touchs:function(obj,windowWidth,tar,distance,endX){
    obj.style.webkitTransform='translate3d('+(distance+endX)+'px,0,0)';
    obj.style.transform='translate3d('+(distance+endX)+',0,0)px';
  },
  lineAnme:function(obj,stance){
    obj.style.webkitTransform='translate3d('+stance+'px,0,0)';
    obj.style.transform='translate3d('+stance+'px,0,0)';
    obj.style.webkitTransition='all 0.1s ease-in-out';
    obj.style.transition='all 0.1s ease-in-out';
  },
  back:function(obj,windowWidth,tar,distance,endX,time){
    obj.style.webkitTransform='translate3d('+(distance+endX)+'px,0,0)';
    obj.style.transform='translate3d('+(distance+endX)+',0,0)px';
    obj.style.webkitTransition='all '+time+'s ease-in-out';
    obj.style.transition='all '+time+'s ease-in-out';
  }
}

  var begin = ""; 
  var end = "";
  var userid = sessionStorage.getItem("userid",userid);

//从后台获取每日数据并渲染数据及图表
function getDaydata(){ 
  var getbeginDate = $("#beginDate").val();
  var getendDate = $("#endDate").val();
  var _data={};
  $.ajax({  
    type: "POST",  
    url: _URL_BASE+"/wx/api/getARCount",
    data: {"dateBegin":getbeginDate,"dateEnd":getendDate,"users":userid},  
    dataType:"json",  
    async:true,  
    cache:false,  
    success: function(json){ 
      if (json.msg=='100'){
    	  var tbody='';
    	  var dayVisitData = 0;
    	  var firstVisitData = 0;
    	  var secondVisitData = 0;
    	  var completeData = 0;
    	  for(var i = 0;i<json.datas.length;i++){
    		  var _realName = json.datas[i].realName;
    		  var _ar01Count = json.datas[i].ar01Count;
    		  firstVisitData += parseInt(json.datas[i].ar01Count);
    		  var _ar02Count = json.datas[i].ar02Count;
    		  secondVisitData += parseInt(json.datas[i].ar02Count);
    		  var _ar03Count = json.datas[i].ar03Count;
    		  completeData += parseInt(json.datas[i].ar03Count);
    		  var _allCount = parseInt(_ar01Count) + parseInt(_ar02Count) + parseInt(_ar03Count);
    		  dayVisitData += _allCount;
			  tbody += '<tr><td>' + _realName + '</td><td>' +_allCount+ '</td><td>' +_ar01Count+ '</td><td>' +_ar02Count+ '</td><td>' +_ar03Count+ '</td></tr>';
    	  }
    	  $("#tbl").html(tbody);
    	  var dom = document.getElementById("dayEcharts");
    	  var myChart = echarts.init(dom);
    	  var app = {};
    	  option = null;
    	  function fetchData(getData) {
    	      // 通过 setTimeout 模拟异步加载
    	      setTimeout(function () {
    	    	  getData({
    	              categories: ["日访","首访","复访","成交"],
    	              data: [dayVisitData, firstVisitData, secondVisitData, completeData]
    	          });
    	      }, 1000);
    	  }
    	  // 初始 option
    	  option = {
    	      title: {
    	          text: '客户访问数据统计'
    	      },
    	      tooltip: {},
    	      legend: {
    	          data:['访问量']
    	      },
    	      xAxis: {
    	          data: []
    	      },
    	      yAxis: {},
    	      series: [{
    	          name: '访问量',
    	          type: 'bar',
    	          data: []
    	      }]
    	  };

    	  fetchData(function (data) {
    	      myChart.setOption({
    	          xAxis: {
    	              data: data.categories
    	          },
    	          series: [{
    	              // 根据名字对应到相应的系列
    	              name: '访问量',
    	              data: data.data
    	          }]
    	      });
    	  });;
    	  if (option && typeof option === "object") {
    	      myChart.setOption(option, true);
    	  }
      }	
    },  
    error: function(json){  
       console.log("获取数据失败");
    }  
  });     
}

//从后台获取每周数据并渲染
function getWeekdata(){ 
  var getbeginDate = $("#weekFirstDay").val();
  var getendDate = $("#weekLastDay").val();
  $("#nowWeekText").html(getbeginDate+"至"+getendDate);
  //$("#nowWeek").val(getbeginDate+"至"+getendDate);
  var _data={};
  $.ajax({  
    type: "POST",  
    url: _URL_BASE+"/wx/api/getARCount",
    data: {"dateBegin":getbeginDate,"dateEnd":getendDate,"users":userid},  
    dataType:"json",  
    async:true,  
    cache:false,  
    success: function(json){ 
        if (json.msg=='100'){
      	  var tbody='';
      	  var dayVisitData = 0;
      	  var firstVisitData = 0;
      	  var secondVisitData = 0;
      	  var completeData = 0;
      	  for(var i = 0;i<json.datas.length;i++){
      		  var _realName = json.datas[i].realName;
      		  var _ar01Count = json.datas[i].ar01Count;
      		  firstVisitData += parseInt(json.datas[i].ar01Count);
      		  var _ar02Count = json.datas[i].ar02Count;
      		  secondVisitData += parseInt(json.datas[i].ar02Count);
      		  var _ar03Count = json.datas[i].ar03Count;
      		  completeData += parseInt(json.datas[i].ar03Count);
      		  var _allCount = parseInt(_ar01Count) + parseInt(_ar02Count) + parseInt(_ar03Count);
      		  dayVisitData += _allCount;
  			  tbody += '<tr><td>' + _realName + '</td><td>' +_allCount+ '</td><td>' +_ar01Count+ '</td><td>' +_ar02Count+ '</td><td>' +_ar03Count+ '</td></tr>';
      	  }
      	  $("#tb2").html(tbody);
      	  var dom = document.getElementById("weekEcharts");
      	  var myChart = echarts.init(dom);
      	  var app = {};
      	  option = null;
      	  function fetchData(getData) {
      	      // 通过 setTimeout 模拟异步加载
      	      setTimeout(function () {
      	    	  getData({
      	              categories: ["周访","首访","复访","成交"],
      	              data: [dayVisitData, firstVisitData, secondVisitData, completeData]
      	          });
      	      }, 1000);
      	  }
      	  // 初始 option
      	  option = {
      	      title: {
      	          text: '客户访问数据统计'
      	      },
      	      tooltip: {},
      	      legend: {
      	          data:['访问量']
      	      },
      	      xAxis: {
      	          data: []
      	      },
      	      yAxis: {},
      	      series: [{
      	          name: '访问量',
      	          type: 'bar',
      	          data: []
      	      }]
      	  };

      	  fetchData(function (data) {
      	      myChart.setOption({
      	          xAxis: {
      	              data: data.categories
      	          },
      	          series: [{
      	              // 根据名字对应到相应的系列
      	              name: '访问量',
      	              data: data.data
      	          }]
      	      });
      	  });;
      	  if (option && typeof option === "object") {
      	      myChart.setOption(option, true);
      	  }
        }	
      },  
    error: function(json){  
       console.log("获取数据失败");
    }  
  });     
}
//从后台获取每月数据并渲染
function getMonthdata(){ 
  var getbeginDate = $("#monthFirstDay").val();
  var getendDate = $("#monthLastDay").val();
  var _data={};
  $.ajax({  
    type: "POST",  
    url: _URL_BASE+"/wx/api/getARCount",
    data: {"dateBegin":getbeginDate,"dateEnd":getendDate,"users":userid},  
    dataType:"json",  
    async:true,  
    cache:false,  
    success: function(json){ 
        if (json.msg=='100'){
      	  var tbody='';
      	  var dayVisitData = 0;
      	  var firstVisitData = 0;
      	  var secondVisitData = 0;
      	  var completeData = 0;
      	  for(var i = 0;i<json.datas.length;i++){
      		  var _realName = json.datas[i].realName;
      		  var _ar01Count = json.datas[i].ar01Count;
      		  firstVisitData += parseInt(json.datas[i].ar01Count);
      		  var _ar02Count = json.datas[i].ar02Count;
      		  secondVisitData += parseInt(json.datas[i].ar02Count);
      		  var _ar03Count = json.datas[i].ar03Count;
      		  completeData += parseInt(json.datas[i].ar03Count);
      		  var _allCount = parseInt(_ar01Count) + parseInt(_ar02Count) + parseInt(_ar03Count);
      		  dayVisitData += _allCount;
  			  tbody += '<tr><td>' + _realName + '</td><td>' +_allCount+ '</td><td>' +_ar01Count+ '</td><td>' +_ar02Count+ '</td><td>' +_ar03Count+ '</td></tr>';
      	  }
      	  $("#tb3").html(tbody);
      	  var dom = document.getElementById("monthEcharts");
      	  var myChart = echarts.init(dom);
      	  var app = {};
      	  option = null;
      	  function fetchData(getData) {
      	      // 通过 setTimeout 模拟异步加载
      	      setTimeout(function () {
      	    	  getData({
      	              categories: ["月访","首访","复访","成交"],
      	              data: [dayVisitData, firstVisitData, secondVisitData, completeData]
      	          });
      	      }, 1000);
      	  }
      	  // 初始 option
      	  option = {
      	      title: {
      	          text: '客户访问数据统计'
      	      },
      	      tooltip: {},
      	      legend: {
      	          data:['访问量']
      	      },
      	      xAxis: {
      	          data: []
      	      },
      	      yAxis: {},
      	      series: [{
      	          name: '访问量',
      	          type: 'bar',
      	          data: []
      	      }]
      	  };

      	  fetchData(function (data) {
      	      myChart.setOption({
      	          xAxis: {
      	              data: data.categories
      	          },
      	          series: [{
      	              // 根据名字对应到相应的系列
      	              name: '访问量',
      	              data: data.data
      	          }]
      	      });
      	  });;
      	  if (option && typeof option === "object") {
      	      myChart.setOption(option, true);
      	  }
        }	
      },  
    error: function(json){  
       console.log("获取数据失败");
    }  
  });     
}

</script>
</body>
</html>