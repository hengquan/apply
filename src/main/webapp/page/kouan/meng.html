<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Bootstrap 101 Template</title>
<!-- Bootstrap -->
<link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
<script src="../js/jquery.min.js"></script>
<script src="../bootstrap/js/bootstrap.min.js"></script>
<script src="../js/util.js"></script>

<style type="text/css">
.head-language {
	color: #fefefe;
	text-align: right;
	font-size: 20px;
}

.head-role {
	font-size: 20px;
	color: #fefefe;
}

#main_icon img {
	width: 64px;
	height: 64px;
	padding: 5px;
}

#main_icon span {
	float: left;
	text-align: center;
}

#channelListData li {
	margin-left: -9px;
	padding-top: 10px;
}

.imgText {
	left: 0;
	position: relative;
	background-color: #000;
	color: white;
	opacity: 0.75;
	width: 100%;
}
</style>
</head>
<body style="background: #eeeeee;">
	<div class="container-fluid">
		<div class="row" style="background: #4169E1;">
			<input type="hidden" id="selLanguage">
			<div class="col-md-6 pull-right head-language">[中文] [蒙文] [ᠾᠧᠩ
				ᠴᠢᠤᠸᠠᠨ ]</div>
			<div class="col-md-6 head-role">
				<input type="hidden" name="roleId" id="roleId"> <b
					id="roleName">咖啡口岸</b>
			</div>
		</div>
		<div class="row">
			<input type="hidden" id="imgNumber" value="3">
			<div id="myCarousel" class="carousel slide">
				<!-- 轮播（Carousel）指标 -->
				<ol class="carousel-indicators">
				</ol>
				<!-- 轮播（Carousel）项目 -->
				<div class="carousel-inner">
					<div class="item active">
						<img src="../img/1.jpg" width="100%" height="100%" alt="First slide">
					</div>
					<div class="item">
						<img src="../img/2.jpg" alt="Second slide">
					</div>
					<div class="item">
						<img src="../img/1.jpg" alt="Third slide">
					</div>
				</div>
				<!-- 轮播（Carousel）导航 -->
				<a class="left carousel-control" href="#myCarousel" role="button"
					data-slide="prev"> <span
					class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
					<span class="sr-only">Previous</span>
				</a> <a class="right carousel-control" href="#myCarousel" role="button"
					data-slide="next"> <span
					class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
					<span class="sr-only">Next</span>
				</a>
			</div>
		</div>
		<div style="clear: both;"></div>
		<div class="row" id="main_icon" style="background: #fefefe">
			<input type="hidden" id="channelNumber" value="3"> <span
				class="col-xs-3 col-lg-3 col-md-3"> <a
				href="./channelList.html">
					<img src="../img/1-1.png" alt=""><br> <label>大美中国</label>
			</a>
			</span> <span class="col-xs-3 col-lg-3 col-md-3"> <a
				href="http://xizang.unimedia.net.cn/zh/archives/category/maintype/meilineimeng">
					<img src="../img/1-2.png" alt=""> <br> <label>神奇西藏</label>
			</a>
			</span> <span class="col-xs-3 col-lg-3 col-md-3"> <a
				href="/archives/category/bianchengzixun" target="_self"> <img
					src="../img/1-3.png" alt=""><br> <label>实时吉隆</label>
			</a>
			</span> <span class="col-xs-3 col-lg-3 col-md-3"> <a
				href="http://xizang.unimedia.net.cn/zh/archives/category/maintype/tongguan">
					<img src="../img/1-4.png" alt=""><br> <label>通关百事通</label>
			</a>
			</span> <span class="col-xs-3 col-lg-3 col-md-3"> <a
				href="http://xizang.unimedia.net.cn/zh/archives/category/maintype/xuyoubiancheng">
					<img src="../img/2-1.png" alt=""><br> <label>醉美吉隆</label>
			</a>
			</span> <span class="col-xs-3 col-lg-3 col-md-3"> <a
				href="http://xizang.unimedia.net.cn/zh/archives/category/maintype/shenbianzhushou">
					<img src="../img/2-2.png" alt=""><br> <label>身边助手</label>
			</a>
			</span> <span class="col-xs-3 col-lg-3 col-md-3"> <a
				href="http://xizang.unimedia.net.cn/zh/archives/category/maintype/chuxing">
					<img src="../img/2-3.png" alt=""><br> <label>旅游攻略</label>
			</a>
			</span> <span class="col-xs-3 col-lg-3 col-md-3"> <a
				href="http://xizang.unimedia.net.cn/zh/archives/category/maintype/caoyuantianlai">
					<img src="../img/2-4.png" alt=""><br> <label>民族音乐</label>
			</a>
			</span>
		</div>
		<div style="clear: both;"></div>
		<div id="channelListData"></div>
		<div class="row"
			style="background: #444; text-align: center; color: #fefefe;margin-top:10px">
			© 2019 <a href="http://xizang.unimedia.net.cn/zh">口岸</a> &nbsp;
		</div>


	</div>
</body>
<script type="text/javascript">
	$(function() {
		// 初始化轮播旋转
		$("#myCarousel").carousel('cycle');
		//口岸标识
		var tab = getQueryString("tab");
		//语言
		var language = getQueryString("language");
		// 初始化口岸名称和语言
		getHomeData(tab, language);
		//轮播图
		getHomePicUrl();
		//获取首面的频道列表
		getHomeChannelList();
		//处理首页频道下面显示的文章
		getArticleList();
	})

	//获取口岸名称和言语
	function getHomeData(tab, language) {
		$.ajax({
			type : 'post',
			data : {
				"tab" : tab,
				"language" : language
			},
			url : '../../api/getHomeData',
			dataType : 'json',
			async : false,
			success : function(data) {
				if (data.code == "200") {
					//渲染站点语言
					var languageHtml = "";
					var languageList = data.languageList;
					for (var i = 0; i < languageList.length; i++) {
						languageHtml += '&nbsp;&nbsp;<span onclick="selLanguage('
								+ languageList[i].tab
								+ ')">['
								+ languageList[i].name + ']</span>'
					}
					$(".head-language").html(languageHtml);
					//渲染口岸名称
					$("#roleName").html(data.roleName);
					//口岸ID
					$("#roleId").val(data.roleId);
					//语言
					$("#selLanguage").val(data.language);
				} else {
					alert(data.msg);
				}
			}
		});
	}

	//获取首页轮播图
	function getHomePicUrl() {
		var imgNumber = $("#imgNumber").val();
		var roleId = $("#roleId").val();
		$.ajax({
			type : 'post',
			data : {
				"imgNumber" : imgNumber,
				"roleId" : roleId
			},
			url : '../../api/getArticlePicUrlList',
			dataType : 'json',
			success : function(data) {
				if (data.code == "200") {
					//渲染站点轮播图
					var imgHtml = "";
					var imgJiaodian = "";
					var dataList = data.dataList;
					for (var i = 0; i < dataList.length; i++) {
						imgHtml += '<div class="item active">'
								+ '<img width="100%" height="100%" src="'
								+ dataList[i].picUrl
								+ '" alt="First slide" onerror="excptionUrl(this)">'
								+ '</div>';
						if (i == 0) {
							imgJiaodian += '<li data-target="#myCarousel" data-slide-to="'+ i +'" class="active"></li>';
						} else {
							imgJiaodian += '<li data-target="#myCarousel" data-slide-to="'+ i +'"></li>';
						}
					}
					$(".carousel-inner").html(imgHtml);
					$(".carousel-indicators").html(imgJiaodian);
				} else {
					alert(data.msg);
				}
			}
		});
	}

	//获取首面的频道列表
	function getHomeChannelList() {
		var channelNumber = $("#channelNumber").val();
		var roleId = $("#roleId").val();
		$.ajax({
			type : 'post',
			data : {
				"channelNumber" : channelNumber,
				"roleId" : roleId
			},
			url : '../../api/getHomeChannelList',
			dataType : 'json',
			async : false,
			success : function(data) {
				if (data.code == "200") {
					//渲染首页频道列表
					var channelHtml = "";
					var dataList = data.channelList;
					for (var i = 0; i < dataList.length; i++) {
						channelHtml += '<div class="row" style="background: #fefefe; margin-top: 5px">'
								+ '<div class="col-md-12" style="border: 1px solid #eeeeee">'
								+ '<label class="col-md-6 btn"><b>'
								+ dataList[i].channelname
								+ '</b></label> '
								+ '<label class="col-md-6 pull-right btn"><b><a href="#" onclick=openArticleList("'+dataList[i].id+'")>更多>></a></b></label>'
								+ '</div>';
						if ((i + 1) % 2 == 0) {
							channelHtml += '<div class="col-xs-12 col-lg-12 col-md-12" style="text-align: left; margin-top: 20px;">'
									+ '<input type="hidden" class="channelId" value="'+ dataList[i].id +'">'
									+ '<input type="hidden" class="channelId" value="3">'
									+ '<div class="theChannelList"></div>'
									+ '</div></div>';
						} else {
							channelHtml += '<div class="col-xs-12 col-lg-12 col-md-12" style="text-align: left; margin-top: 5px;">'
									+ '<input type="hidden" class="channelId" value="'+ dataList[i].id +'">'
									+ '<input type="hidden" class="channelNumber" value="3">'
									+ '<ul class="theChannelList"></ul>'
									+ '</div></div>';
						}
					}
					$("#channelListData").html(channelHtml);
				} else {
					alert(data.msg);
				}
			}
		});
	}

	//处理首页频道下面显示的文章
	function getArticleList() {
		$("#channelListData .row").each(function(index, obj) {
			var theChannelList = $(obj).find(".theChannelList");
			var channelId = $(obj).find(".channelId").val();
			var articleNumber = $(obj).find(".articleNumber")
					.val();
			var language = $("#selLanguage").val();
			$.ajax({
				type : 'post',
				data : {
					"language" : language,
					"channelId" : channelId,
					"pageSize" : articleNumber
				},
				url : '../../api/getArticleList',
				dataType : 'json',
				async : false,
				success : function(data) {
					if (data.code == "200") {
						//渲染首页频道列表
						var html = "";
						var dataList = data.dataList;
						for (var i = 0; i < dataList.length; i++) {
							if ((index + 1) % 2 == 0) {
								html += '<span class="col-xs-4 col-lg-4 col-md-4" style="padding-right: 2px;padding-left: 2px;">'
								+'<a href="#" onclick=openArticleContent("'+dataList[i].id+'")>'
								+'<img src="'+ dataList[i].picUrl +'" width="100%" alt="" onerror="excptionUrl(this)"><br>'
								+'<div class="imgText">'+ dataList[i].articleName +'</div>'
								+'</a>'
								+'</span>';
							} else {
								html += '<li><a href="#" onclick=openArticleContent("'+dataList[i].id+'")>'+ dataList[i].articleName +'</a></li>';
							}
						}
						theChannelList.html(html);
					} else {
						alert(data.msg);
					}
				}
			});
		})
	}

	//处理访问不到的图片给个默认图
	function excptionUrl(obj) {
		var obj = $(obj);
		obj.attr("src", '../img/1.jpg');
	}
	
	//打开文章列表页
	function openArticleList(channelId){
		var language = $("#selLanguage").val();
		window.location.href="./articleList.html?channelId="+channelId+"&language="+language;
	}
	
	//打开文章列表页
	function openArticleContent(articleId){
		var language = $("#selLanguage").val();
		window.location.href="./content.html?articleId="+articleId+"&language="+language;
	}
</script>
</html>